(()=>{"use strict";var e={538:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(601),i=s.n(n),r=s(314),a=s.n(r)()(i());a.push([e.id,"",""]);const o=a},689:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(601),i=s.n(n),r=s(314),a=s.n(r)()(i());a.push([e.id,"",""]);const o=a},11:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(601),i=s.n(n),r=s(314),a=s.n(r)()(i());a.push([e.id,"",""]);const o=a},949:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(601),i=s.n(n),r=s(314),a=s.n(r)()(i());a.push([e.id,"",""]);const o=a},665:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(601),i=s.n(n),r=s(314),a=s.n(r)()(i());a.push([e.id,"",""]);const o=a},809:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(601),i=s.n(n),r=s(314),a=s.n(r)()(i());a.push([e.id,"",""]);const o=a},338:(e,t,s)=>{s.d(t,{A:()=>o});var n=s(601),i=s.n(n),r=s(314),a=s.n(r)()(i());a.push([e.id,"",""]);const o=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",n=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),n&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),n&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,n,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(n)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);n&&a[h[0]]||(void 0!==r&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=r),s&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=s):h[2]=s),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),t.push(h))}},t}},601:e=>{e.exports=function(e){return e[1]}},385:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},72:e=>{var t=[];function s(e){for(var s=-1,n=0;n<t.length;n++)if(t[n].identifier===e){s=n;break}return s}function n(e,n){for(var r={},a=[],o=0;o<e.length;o++){var l=e[o],c=n.base?l[0]+n.base:l[0],h=r[c]||0,d="".concat(c," ").concat(h);r[c]=h+1;var u=s(d),g={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(g);else{var m=i(g,n);n.byIndex=o,t.splice(o,0,{identifier:d,updater:m,references:1})}a.push(d)}return a}function i(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,i){var r=n(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var o=s(r[a]);t[o].references--}for(var l=n(e,i),c=0;c<r.length;c++){var h=s(r[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}r=l}}},659:e=>{var t={};e.exports=function(e,s){var n=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(s)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,s)=>{e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var n="";s.supports&&(n+="@supports (".concat(s.supports,") {")),s.media&&(n+="@media ".concat(s.media," {"));var i=void 0!==s.layer;i&&(n+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),n+=s.css,i&&(n+="}"),s.media&&(n+="}"),s.supports&&(n+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},467:(e,t,s)=>{e.exports=s.p+"cd7716048ffbda0235e6.ts"}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,s),r.exports}s.m=e,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s.b=document.baseURI||self.location.href,s.nc=void 0,(()=>{var e=s(385),t=s.n(e),n=new URL(s(467),s.b);t()(n);var i=s(72),r=s.n(i),a=s(825),o=s.n(a),l=s(659),c=s.n(l),h=s(56),d=s.n(h),u=s(540),g=s.n(u),m=s(113),p=s.n(m),f=s(538),v={};v.styleTagTransform=p(),v.setAttributes=d(),v.insert=c().bind(null,"head"),v.domAPI=o(),v.insertStyleElement=g(),r()(f.A,v),f.A&&f.A.locals&&f.A.locals;var b=s(338),y={};y.styleTagTransform=p(),y.setAttributes=d(),y.insert=c().bind(null,"head"),y.domAPI=o(),y.insertStyleElement=g(),r()(b.A,y),b.A&&b.A.locals&&b.A.locals;var w=s(949),A={};A.styleTagTransform=p(),A.setAttributes=d(),A.insert=c().bind(null,"head"),A.domAPI=o(),A.insertStyleElement=g(),r()(w.A,A),w.A&&w.A.locals&&w.A.locals;var E=s(809),C={};C.styleTagTransform=p(),C.setAttributes=d(),C.insert=c().bind(null,"head"),C.domAPI=o(),C.insertStyleElement=g(),r()(E.A,C),E.A&&E.A.locals&&E.A.locals;const S=class{constructor({tagName:e="div",className:t="",textContent:s="",attributes:n={}},...i){this.children=[];const r=document.createElement(e);r.className=t,r.textContent=s,this.elem=r,n&&this.setAttributes(n),i&&this.appendChildren(i)}setTextContent(e){this.elem.textContent=e}getTextContent(){return this.elem.textContent?this.elem.textContent:(console.error("no text content"),null)}deleteAttribute(e){this.elem.removeAttribute(e)}setAttributes(e){e&&this.elem&&Object.keys(e).forEach((t=>{const s=e[t];"boolean"==typeof s?this.elem.setAttribute(t,""):this.elem.setAttribute(t,s)}))}appendChildren(e){e.forEach((e=>this.append(e)))}append(e){this.children.push(e),this.elem?.append(e.getElement())}getElement(){return this.elem}addListener(e,t,s=!1){this.elem.addEventListener(e,t,s)}removeListener(e,t,s=!1){this.elem.removeEventListener(e,t,s)}deleteChildren(){this.children.forEach((e=>{e.delete()})),this.children.length=0}deleteChild(e){const t=this.children.indexOf(e);-1!==t&&(this.children.splice(t,1),e.elem.remove())}getAllChildrenMap(){const e=new Map,t=s=>{const n=s.elem.className.split(" ")[0];e.set(n,s),s.children.forEach((e=>t(e)))};return this.children.forEach((e=>t(e))),e}delete(){this.deleteChildren(),this.elem.remove()}addStyle(e){const t=this.elem.style;Object.keys(e).forEach((s=>{t.setProperty(s,e[s])}))}getWidth(){return this.elem.clientWidth}toggleClass(e){this.elem.classList.toggle(e)}},L=class extends S{constructor({className:e,textContent:t,clickHandler:s}){super({tagName:"button",className:`${e} button`,textContent:t}),this.clickHandler=s??(()=>{}),this.addListener("click",this.clickHandler)}delete(){this.clickHandler&&this.removeListener("click",this.clickHandler),super.delete()}},N=class extends S{constructor({className:e,id:t="",type:s="",placeholder:n=""}){super({tagName:"input",className:`${e} input`,attributes:{id:t,type:s,placeholder:n}})}get value(){return this.getElement().value}get id(){return this.getElement().id}deleteValue(){this.getElement().value=""}},x=(e,...t)=>new S({tagName:"div",className:e},...t),k=(e,t,s="",...n)=>new S({tagName:"a",className:e,textContent:t,attributes:{href:s}},...n),M=(e,t)=>new S({tagName:"p",className:e,textContent:t}),T=(e,t)=>new S({tagName:"h1",className:e,textContent:t}),U=(e,t,s)=>new L({className:e,textContent:t,clickHandler:s}),I=(e,t,s="")=>new S({tagName:"span",className:e,textContent:t,attributes:{id:s}}),O=(e,t,s="",n="")=>new N({className:e,id:n,type:t,placeholder:s}),_=class{constructor(e){this.loginBtn=void 0,this.aboutBtn=void 0,this.inputs=[],this.errorMessage=void 0,this.callback=null,this.callback=e,this.isLogin=!1,this.view=this.createView().element.getElement()}login(){if(this.isValid()){const e=this.collectInputData();sessionStorage.setItem("user",JSON.stringify(e)),this.isLogin=!0,this.callback&&this.callback()}else console.error("failed login");return!1}logout(){sessionStorage.clear(),this.isLogin=!1}addErrorMessage(e){const t=I("error",`${e.toUpperCase()}`);this.errorMessage?.deleteChildren(),this.errorMessage?.append(t)}getSessionUser(){const e=sessionStorage.getItem("user");return e?JSON.parse(e):null}collectInputData(){const e={};return this.inputs.forEach((t=>{e[t.input.id]=t.input.value})),e}isValid(){return this.inputs.map((e=>{const{isValid:t,message:s}=this.validate(e.input);return e.hint.setTextContent(s),t})).every((e=>e))}validate(e){let t="ã…¤",s=!1;switch(!0){case 0===e.value.length:t="The field must not be empty";break;case"login"===e.id&&!/^[a-zA-Z-]+$/.test(e.value):t="Only letters of the English alphabet and the hyphen symbol";break;case"login"===e.id&&e.value.length<3:t="Minimum length - 3 characters";break;case"password"===e.id&&e.value.length<6:t="Minimum length - 6 characters";break;case"login"===e.id&&!/^[A-Z]/.test(e.value):t="The first letter must be in uppercase";break;case e.value.length>10:t="Maximum length - 10 characters";break;default:s=!0}return{isValid:s,message:t}}createView(){this.loginBtn=U("btn btn-primary btn-login","Login",(()=>{this.login()})),this.aboutBtn=U("btn btn-primary btn-about","About",(()=>{})),this.loginBtn.addListener("submit",(e=>{e.preventDefault(),this.login()}));const e=O(" form-control input-login","text","","login"),t=I("form-text","ã…¤");this.errorMessage=x("error-message");const s=O("form-control input-password","password","","password"),n=I("form-text","ã…¤");this.inputs.push({input:e,hint:t},{input:s,hint:n});const i=x("container-fluid login-container",x("login-content",T("login-content__title","Welcome to FUN-CHAT"),M("login-content__description","Please login"),this.errorMessage,x("form mb-3 align-items-center",x("input-group",I("input-group-text","Login","login-first-name"),e),t),x("form mb-3 align-items-center",x("input-group col-8",I("input-group-text","Password","login-second-name"),s),n),this.loginBtn,this.aboutBtn));return i.addListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),this.login())})),{element:i,map:i.getAllChildrenMap()}}};class R{static tryReconnect(e,t){const s=setInterval((()=>{R.socket=new WebSocket("ws://localhost:4000"),R.socket.onopen=()=>{setTimeout((()=>{t(),e()}),5e3),clearInterval(s)}}),5e3)}static userAuth(e){const t={id:R.generateUniqueId(),type:"USER_LOGIN",payload:{user:e}};R.socket.readyState===WebSocket.OPEN&&R.socket.send(JSON.stringify(t))}static send(e){R.socket.readyState===WebSocket.OPEN&&R.socket.send(JSON.stringify(e))}static generateUniqueId(){return"unique_id"}}R.socket=new WebSocket("ws://localhost:4000");const V=R;var $=s(11),B={};B.styleTagTransform=p(),B.setAttributes=d(),B.insert=c().bind(null,"head"),B.domAPI=o(),B.insertStyleElement=g(),r()($.A,B),$.A&&$.A.locals&&$.A.locals;var F=s(665),P={};P.styleTagTransform=p(),P.setAttributes=d(),P.insert=c().bind(null,"head"),P.domAPI=o(),P.insertStyleElement=g(),r()(F.A,P),F.A&&F.A.locals&&F.A.locals;const H=class{constructor(e,t=""){this.view=void 0,this.password="",this.unreadMessageCount=0,this.privatelogin=e.login,this.privateName=e.login,this.isLogined=e.isLogined,this.iconColor=this.randomColor(),this.password=t}render(){const e=x("flex-shrink-0 me-2 user-item__icon",M("user-item__icon-text",`${this.shortName()}`));return e.setAttributes({style:`background-color: ${this.iconColor};`}),this.view=x("d-flex text-muted pt-3 user-item",e,x("pb-3 mb-0 small lh-sm w-100",M("user-item__name",`${this.privateName}`),I("user-item__status",`${this.createStatusString()}`)),I("mx-2 unread-count",(0===this.unreadMessageCount?"":`${this.unreadMessageCount}`)+" ")),this.view.addListener("click",(()=>{})),this.view}logout(){this.isLogined=!1;const e={user:{login:this.login,password:this.password}};V.send({id:"",type:"USER_LOGOUT",payload:e})}createStatusString(){return this.status?"Online":"Offline"}shortName(){return this.privateName[0]}get status(){return this.isLogined}get name(){return this.privateName}get login(){return this.privatelogin}randomColor(){return`#${Math.floor(16777215*Math.random()).toString(16)}`}increaseUnreadMessageCount(){this.unreadMessageCount+=1}};var j=s(689),D={};function G(e){e.scrollTo({top:e.scrollHeight})}D.styleTagTransform=p(),D.setAttributes=d(),D.insert=c().bind(null,"head"),D.domAPI=o(),D.insertStyleElement=g(),r()(j.A,D),j.A&&j.A.locals&&j.A.locals;const W=class{constructor(e,t,s){this.dialogContainer=null,this.userTo=t,this.userFrom=e,this.statusUserTo=s?"Online":"Offline",this.view=this.createView()}createView(){return this.dialogContainer=x("dialog-container"),x("dialog-view",x("dialog-info",M("info-text",`${this.userTo} is ${this.statusUserTo}`)),this.dialogContainer)}appendMessage(e){"MSG_SEND"===e.type&&this.createMessage(e.payload.message)}createMessage(e){let t;t=e.from===this.userTo?"message message--left":"message message--right";const s=x(`${t}`,M("message__author",`${e.from}`),M("message__text",`${e.text}`),M("message__time text-body-secondary",`${function(e){const t=new Date(e);return`${t.getHours()}:${t.getMinutes()}`}(e.datetime)}`));this.dialogContainer&&this.dialogContainer.append(s),this.dialogContainer?.getElement()&&G(this.dialogContainer?.getElement())}updateHistory(e){0!==e.length?(e.forEach((e=>{this.createMessage(e)})),this.dialogContainer?.getElement()&&G(this.dialogContainer?.getElement())):this.dialogContainer?.append(new S({tagName:"div",className:"",textContent:"Its start dialog, go chatting"}))}getHistory(){V.send({id:"",type:"MSG_FROM_USER",payload:{user:{login:this.userTo}}})}send(e){V.send({id:null,type:"MSG_SEND",payload:{message:{to:this.userTo,text:e}}})}},J=class{constructor(e,t){this.users=null,this.usersActiveList=void 0,this.usersOfflineList=void 0,this.usersSearchList=void 0,this.inputMessage=void 0,this.aboutBtn=void 0,this.isLoggedIn=!1,this.chatField=void 0,this.communication=null,this.btnSend=void 0,this.searchUserInput=void 0,this.user=new H(e,t),this.view=this.createView().element.getElement(),this.userName=e.login,this.isLoggedIn=e.isLogined,this.chatInit(),this.communication||this.btnSend?.setAttributes({disabled:!0}),this.searchUserInput?.addListener("input",(e=>{this.searchUser(e)}))}findUser(e){return this.users?.find((t=>t.login===e))}searchUser(e){const t=e.target.value,s=this.users?[...this.users]:[];if(0===s.length||0===t.length)return;const n=s.slice().filter((e=>e.login.toLowerCase().includes(t.toLowerCase())));n.length>0&&(this.usersSearchList?.deleteChildren(),this.renderFilteredUser(n))}renderFilteredUser(e){e.forEach((e=>{e.view&&this.usersSearchList.append(e.view)}))}chatInit(){this.usersActiveList?.deleteChildren(),this.usersOfflineList?.deleteChildren(),V.send({id:null,type:"USER_ACTIVE",payload:null}),V.send({id:null,type:"USER_INACTIVE",payload:null})}renderUsers(e){this.users=[],e.forEach((e=>{if(e.login===this.user.login)return;const t=new H(e);this.users?.push(t);const s=t.render();t.view?.addListener("click",(()=>this.startChat(e))),t.status?this.usersActiveList.append(s):this.usersOfflineList.append(s)}))}startChat(e){this.communication=new W(this.user.login,e.login,e.isLogined),this.chatField?.deleteChildren(),this.chatField?.append(this.communication.view),this.btnSend?.deleteAttribute("disabled"),this.btnSend?.addListener("click",(()=>{this.sendMessage()})),this.inputMessage?.addListener("keydown",(e=>{"Enter"===e.key&&this.sendMessage()})),this.communication.getHistory()}sendMessage(){const e=this.getInputText();0!==e.length&&(this.communication&&this.communication.send(e),this.inputMessage?.deleteValue(),this.communication?.dialogContainer?.getElement()&&G(this.communication?.dialogContainer?.getElement()))}getInputText(){return this.inputMessage?this.inputMessage.value.trim():""}createView(){const e=U("chat-logout","Logout",(()=>{this.user.logout()}));this.aboutBtn=U("about-chat","About",(()=>{})),this.usersActiveList=x("users-active-field"),this.usersSearchList=x("users-search-field"),this.usersOfflineList=x("users-offline-field"),this.chatField=x("chat-content",M("","Select user for start message")),this.btnSend=U("send-message","Send",(()=>{})),this.inputMessage=O("input-message","text","Write message",""),this.searchUserInput=O("input-user-search","text","Search User","");const t=x("container chat-container",((e,...t)=>new S({tagName:"nav",className:e},...t))("nav chat-nav",M("user-name",`${this.user.login}`),M("app-name","Fun-chat"),x("btn-chat-nav",e,this.aboutBtn)),x("chat-fields",x("users-fields col-3 border border-right-0 border-dark",this.searchUserInput,this.usersSearchList,M("","Users online"),this.usersActiveList,M("","Users offline"),this.usersOfflineList),x("d-flex flex-column justify-content-between col-9 border border-dark p-2 message-field",this.chatField,x("d-flex gap-2 input-message-container",this.inputMessage,this.btnSend))),x("d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top footer",M("footer-year","2024"),k("footer-author","LinderJK","https://github.com/LinderJK"),x("footer-img",k("footer-school-link","","https://rs.school/courses/javascript-mentoring-program",((e,t="")=>new S({tagName:"img",className:"footer-school",attributes:{src:t}}))(0,"./assets/img/rsschool.jpg")))));return{element:t,map:t.getAllChildrenMap()}}},q=class{constructor(){this.root=document.querySelector("#root"),this.chat=void 0,this.aboutView=void 0,this.reconnectView=void 0,this.login=new _(this.startLogin.bind(this)),this.reconnectView=(()=>{const e=x("container-fluid p-0 app-container",x("container reconnect-content my-5",x("main",T("reconnect-title","Welcome to Fun-chat"),M("reconnect-description","SERVER CONNECTION PROBLEM, PLEASE STEND BY"),M("reconnect-description","TRY TO RECONNECT EVERY 5 SECONDS"))));return{element:e,map:e.getAllChildrenMap()}})(),this.listenSocket(),this.aboutView=(e=>{const t=x("container-fluid p-0 app-container",x("container about-content my-5",x("main",T("about-title","Welcome to Fun-chat"),M("about-description",'"Fun Chat" is an application for communicating with friends and loved ones in real-time. With its help, users can exchange messages, share their thoughts, impressions, and emotions.')),U("about-btn","Back",e)));return{element:t,map:t.getAllChildrenMap()}})((()=>{this.chat?.user&&this.chat.user.isLogined?this.render(this.chat.view):this.chat?.user.isLogined||this.render(this.login.view)})),this.addButtonListeners()}addButtonListeners(){const e=this.aboutView?.element.getElement();e&&(this.login.aboutBtn?.addListener("click",this.render.bind(this,e)),this.chat?.aboutBtn?.addListener("click",this.render.bind(this,e)))}start(){this.root||console.error("dont find root"),this.startLogin()}startLogin(){const e=this.login.getSessionUser();e?V.userAuth(e):this.render(this.login.view)}listenSocket(){V.socket.onmessage=e=>{this.messageHandler(e)},V.socket.onopen=()=>{this.startLogin()},V.socket.onclose=()=>{const e=this.reconnectView?.element.getElement();e&&(this.render(e),V.tryReconnect(this.startLogin.bind(this),this.listenSocket.bind(this)))}}messageHandler(e){const t=JSON.parse(e.data);switch(t.type){case"USER_LOGIN":this.startChat(t.payload.user);break;case"USER_LOGOUT":this.login.logout(),this.render(this.login.view);break;case"USER_ACTIVE":case"USER_INACTIVE":this.chat?.renderUsers(t.payload.users);break;case"USER_EXTERNAL_LOGOUT":case"USER_EXTERNAL_LOGIN":this.chat?.chatInit();break;case"MSG_SEND":if(t.payload.message.from!==this.chat?.communication?.userFrom&&t.payload.message.from!==this.chat?.communication?.userTo&&this.chat){new W(t.payload.message.from,this.chat?.user.login,this.chat?.user.status).createMessage(t.payload.message);const e=this.chat?.findUser(t.payload.message.from);return void(e&&e.increaseUnreadMessageCount())}this.chat?.communication?.appendMessage(t);break;case"MSG_FROM_USER":this.chat?.communication?.updateHistory(t.payload.messages);break;case"ERROR":this.login&&(this.login.addErrorMessage(t.payload.error),this.login.logout());break;default:console.warn(`Unhandled message type: ${t.type}`)}}startChat(e){const t=this.login.getSessionUser()?.password;t&&(this.chat=new J(e,t),this.render(this.chat.view),this.addButtonListeners())}render(e){if(this.root){for(;this.root.firstChild;)this.root.removeChild(this.root.firstChild);this.root.append(e)}else console.error("dont find root")}};class Y{constructor(){Y.app=this,this.manager=new q}start(){this.manager.start()}static getApplication(){return Y.app}}(new Y).start()})()})();